<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ГРОРХИД — Mini App</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    :root{
      --bg:#0b0f14;
      --card:#121826;
      --card2:#0f1522;
      --text:#e8eefc;
      --muted:#a7b4cf;
      --line:rgba(255,255,255,.08);
      --accent:#7c5cff;
      --accent2:#19c37d;
      --danger:#ff5c7a;
      --shadow: 0 12px 30px rgba(0,0,0,.35);
      --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,"Noto Sans","Helvetica Neue",sans-serif;
      background:
        radial-gradient(1200px 800px at 20% -10%, rgba(124,92,255,.18), transparent 55%),
        radial-gradient(900px 700px at 120% 10%, rgba(25,195,125,.12), transparent 55%),
        var(--bg);
      color:var(--text);
    }
    .wrap{max-width:980px;margin:0 auto;padding:18px 14px 20px;}
    .topbar{
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      padding:14px;border:1px solid var(--line);border-radius:var(--radius);
      background:rgba(18,24,38,.85);box-shadow:var(--shadow);backdrop-filter:blur(10px);
      position:sticky;top:10px;z-index:30;
    }
    .brand{display:flex;flex-direction:column;gap:2px}
    .brand .name{font-weight:900;letter-spacing:.4px}
    .brand .desc{font-size:12px;color:var(--muted)}
    .btn{
      border:1px solid var(--line);
      background:rgba(255,255,255,.06);
      color:var(--text);
      padding:10px 12px;border-radius:12px;
      cursor:pointer;font-weight:800;transition:.15s ease;
      display:inline-flex;align-items:center;justify-content:center;gap:8px;
      user-select:none;
    }
    .btn:hover{transform:translateY(-1px);background:rgba(255,255,255,.09);}
    .btn.primary{border-color:rgba(124,92,255,.55);background:rgba(124,92,255,.18);}
    .btn.primary:hover{background:rgba(124,92,255,.24);}
    .btn.success{border-color:rgba(25,195,125,.55);background:rgba(25,195,125,.14);}
    .btn.success:hover{background:rgba(25,195,125,.2);}
    .btn.danger{border-color:rgba(255,92,122,.5);background:rgba(255,92,122,.12);}
    .btn.danger:hover{background:rgba(255,92,122,.18);}

    .card{
      margin-top:14px;
      background:rgba(18,24,38,.75);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .hd{
      padding:14px 14px 10px;
      border-bottom:1px solid var(--line);
      background:linear-gradient(180deg, rgba(255,255,255,.04), transparent);
      display:flex;align-items:flex-end;justify-content:space-between;gap:12px;
    }
    .hd h2{margin:0;font-size:16px;letter-spacing:.2px}
    .hd p{margin:4px 0 0;font-size:12px;color:var(--muted);line-height:1.35}
    .bd{padding:14px;}

    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
    @media(max-width:860px){.grid2{grid-template-columns:1fr}}
    .bigBtn{
      width:100%;
      padding:16px 14px;
      border-radius:16px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.04);
      text-align:left;
      cursor:pointer;
      transition:.15s ease;
      box-shadow:0 10px 22px rgba(0,0,0,.18);
    }
    .bigBtn:hover{transform:translateY(-1px);background:rgba(255,255,255,.07);}
    .bigBtn .t{font-weight:950;font-size:15px;margin:0 0 4px}
    .bigBtn .s{font-size:12px;color:var(--muted);margin:0;line-height:1.35}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;}
    .search{display:flex;gap:10px;margin-top:10px;}
    .inp{
      flex:1;
      background:rgba(255,255,255,.04);
      border:1px solid var(--line);
      border-radius:12px;
      padding:11px 12px;color:var(--text);
      outline:none;font-size:14px;
    }
    .inp::placeholder{color:rgba(167,180,207,.7);}
    .list{display:grid;grid-template-columns:1fr;gap:10px;margin-top:12px;}
    .item{
      border:1px solid var(--line);
      background:rgba(255,255,255,.03);
      border-radius:16px;
      padding:12px;
      display:flex;gap:12px;align-items:flex-start;justify-content:space-between;
    }
    .meta{display:flex;flex-direction:column;gap:4px;min-width:0;}
    .ttl{font-weight:950;font-size:14px;line-height:1.25;}
    .sub{font-size:12px;color:var(--muted);line-height:1.35;}
    .actions{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end;align-items:center;flex-shrink:0;}
    .badge{
      font-size:11px;color:var(--muted);
      border:1px solid var(--line);
      background:rgba(0,0,0,.18);
      border-radius:999px;
      padding:5px 8px;
      display:inline-flex;
      gap:6px;
      align-items:center;
    }
    .hr{height:1px;background:var(--line);margin:12px 0;}
    .hint{font-size:12px;color:var(--muted);line-height:1.35;}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:12px;color:rgba(232,238,252,.9);}

    .pillTabs{display:flex;gap:8px;flex-wrap:wrap;}
    .pillTab{
      padding:9px 11px;
      border-radius:999px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.04);
      color:var(--muted);
      cursor:pointer;
      font-weight:900;
      font-size:12px;
      transition:.12s ease;
      user-select:none;
    }
    .pillTab.active{
      color:var(--text);
      border-color:rgba(124,92,255,.55);
      background:rgba(124,92,255,.18);
    }
    .sectionBox{
      border:1px solid var(--line);
      border-radius:16px;
      padding:12px;
      background:rgba(15,21,34,.55);
    }
    .sectionBox b{display:block;font-size:12px;color:rgba(124,92,255,.95);margin-bottom:6px;letter-spacing:.2px}
    .sectionBox div{font-size:13px;line-height:1.5;color:var(--text)}

    .navTop{
      display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:10px;
    }
    .backBtn{padding:10px 12px;border-radius:12px}
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="name">ГРОРХИД</div>
        <div class="desc" id="pageSubtitle">Мини-приложение: магазин + справочник</div>
      </div>
      <div class="row">
        <button class="btn primary" id="btnHome">Главная</button>
        <button class="btn success" id="btnSupport">Поддержка</button>
      </div>
    </div>

    <!-- HOME -->
    <div class="card" id="viewHome">
      <div class="hd">
        <div>
          <h2>Главное меню</h2>
          <p>Выбери, что тебе нужно: купить грунт или посмотреть правила ухода</p>
        </div>
      </div>
      <div class="bd">
        <div class="grid2">
          <div class="bigBtn" id="goShop">
            <div class="t">Магазин</div>
            <div class="s">Перейти в WB / Ozon и выбрать товары ГРОРХИД</div>
          </div>
          <div class="bigBtn" id="goGuide">
            <div class="t">Справочник растений</div>
            <div class="s">Выбрать растение → пересадка / полив / уход / природа</div>
          </div>
          <div class="bigBtn" id="goCatalog">
            <div class="t">Каталог товаров</div>
            <div class="s">Все позиции списком (быстрый поиск)</div>
          </div>
          <div class="bigBtn" id="goAbout">
            <div class="t">О нас</div>
            <div class="s">Контакты, магазины, полезная информация</div>
          </div>
        </div>
      </div>
    </div>

    <!-- SHOP -->
    <div class="card" id="viewShop" style="display:none;">
      <div class="hd">
        <div>
          <h2>Магазин</h2>
          <p>Открой витрину и выбери нужный грунт</p>
        </div>
      </div>
      <div class="bd">
        <div class="navTop">
          <button class="btn backBtn" id="backFromShop">← Назад</button>
          <div class="row">
            <button class="btn primary" id="openWBShop">Магазин WB</button>
            <button class="btn primary" id="openOZShop">Магазин Ozon</button>
          </div>
        </div>

        <div class="hr"></div>
        <div class="hint">Популярное:</div>
        <div class="row" style="margin-top:10px;">
          <button class="btn" id="qOrch">Орхидея</button>
          <button class="btn" id="qZami">Замиокулькас</button>
          <button class="btn" id="qSpat">Спатифиллум</button>
        </div>
      </div>
    </div>

    <!-- GUIDE: PLANTS LIST -->
    <div class="card" id="viewGuide" style="display:none;">
      <div class="hd">
        <div>
          <h2>Справочник растений</h2>
          <p>Сначала выбери растение</p>
        </div>
      </div>
      <div class="bd">
        <div class="navTop">
          <button class="btn backBtn" id="backFromGuide">← Назад</button>
          <span class="badge">Шаг 1 из 2</span>
        </div>

        <div class="search">
          <input class="inp" id="plantSearch" placeholder="Поиск: спатифиллум, замиокулькас, орхидея, фикус, пальмы…" />
          <button class="btn" id="clearPlantSearch">Очистить</button>
        </div>

        <div class="list" id="plantsList"></div>
      </div>
    </div>

    <!-- GUIDE: PLANT DETAIL -->
    <div class="card" id="viewPlant" style="display:none;">
      <div class="hd">
        <div>
          <h2 id="plantTitle">Растение</h2>
          <p id="plantSubtitle">Выбери раздел</p>
        </div>
      </div>
      <div class="bd">
        <div class="navTop">
          <button class="btn backBtn" id="backToPlants">← К растениям</button>
          <span class="badge">Шаг 2 из 2</span>
        </div>

        <div class="pillTabs" id="topicTabs"></div>

        <div style="margin-top:12px;" id="topicContent"></div>

        <div class="hr"></div>
        <div class="hint">Рекомендованные товары:</div>
        <div class="row" style="margin-top:10px;" id="plantProducts"></div>
      </div>
    </div>

    <!-- CATALOG -->
    <div class="card" id="viewCatalog" style="display:none;">
      <div class="hd">
        <div>
          <h2>Каталог товаров</h2>
          <p>Поиск по всем позициям</p>
        </div>
      </div>
      <div class="bd">
        <div class="navTop">
          <button class="btn backBtn" id="backFromCatalog">← Назад</button>
          <span class="badge">Список</span>
        </div>

        <div class="search">
          <input class="inp" id="catalogSearch" placeholder="Поиск: орхидея 5л, кора, керамзит…" />
          <button class="btn" id="clearCatalogSearch">Очистить</button>
        </div>

        <div class="list" id="catalogList"></div>
      </div>
    </div>

    <!-- ABOUT -->
    <div class="card" id="viewAbout" style="display:none;">
      <div class="hd">
        <div>
          <h2>О нас</h2>
          <p>Контакты и магазины</p>
        </div>
      </div>
      <div class="bd">
        <div class="navTop">
          <button class="btn backBtn" id="backFromAbout">← Назад</button>
          <span class="badge">Info</span>
        </div>

        <div class="sectionBox">
          <b>Поддержка</b>
          <div>Написать: <span class="mono">@melnikovnikitaa</span></div>
        </div>

        <div class="hr"></div>

        <div class="sectionBox">
          <b>WB магазин</b>
          <div class="mono">https://www.wildberries.ru/seller/526266</div>
        </div>

        <div style="height:10px"></div>

        <div class="sectionBox">
          <b>Ozon магазин</b>
          <div class="mono">https://www.ozon.ru/seller/grorhid-2031622/</div>
        </div>

        <div class="hr"></div>

        <div class="hint">
          Mini App работает автономно на Vercel — терминал не нужен. Терминал требуется только для обновлений кода.
        </div>
      </div>
    </div>
  </div>

  <script>
    // Telegram helpers
    const tg = window.Telegram && window.Telegram.WebApp ? window.Telegram.WebApp : null;
    function openLink(url){
      if (tg && tg.openLink) tg.openLink(url);
      else window.open(url, "_blank", "noopener,noreferrer");
    }
    function haptic(kind="impact", style="light"){
      try{
        if (!tg || !tg.HapticFeedback) return;
        if (kind==="impact") tg.HapticFeedback.impactOccurred(style);
        if (kind==="success") tg.HapticFeedback.notificationOccurred("success");
        if (kind==="warning") tg.HapticFeedback.notificationOccurred("warning");
        if (kind==="error") tg.HapticFeedback.notificationOccurred("error");
      }catch(e){}
    }
    function initTelegram(){
      if (!tg) return;
      try{
        tg.ready(); tg.expand();
        tg.setHeaderColor("#0b0f14");
        tg.setBackgroundColor("#0b0f14");
      }catch(e){}
    }

    // Data
    const shops = {
      wb: "https://www.wildberries.ru/seller/526266",
      oz: "https://www.ozon.ru/seller/grorhid-2031622/"
    };

    const products = [
      // WB
      { id:"wb_orch_1", name:"Грунт для орхидей 1л (WB)", platform:"WB", tag:"Орхидеи", url:"https://www.wildberries.ru/catalog/242662173/detail.aspx" },
      { id:"wb_orch_2", name:"Грунт для орхидей 2л (WB)", platform:"WB", tag:"Орхидеи", url:"https://www.wildberries.ru/catalog/230055721/detail.aspx?targetUrl=GP" },
      { id:"wb_orch_3", name:"Грунт для орхидей 3л (WB)", platform:"WB", tag:"Орхидеи", url:"https://www.wildberries.ru/catalog/321372762/detail.aspx?targetUrl=GP" },
      { id:"wb_orch_5", name:"Грунт для орхидей 5л (WB)", platform:"WB", tag:"Орхидеи", url:"https://www.wildberries.ru/catalog/340068487/detail.aspx?targetUrl=GP" },

      { id:"wb_zami_5", name:"Грунт для замиокулькаса 5л (WB)", platform:"WB", tag:"Замиокулькас", url:"https://www.wildberries.ru/catalog/327492373/detail.aspx?targetUrl=GP" },
      { id:"wb_zami_3", name:"Грунт для замиокулькаса 3л (WB)", platform:"WB", tag:"Замиокулькас", url:"https://www.wildberries.ru/catalog/321383073/detail.aspx?targetUrl=GP" },

      { id:"wb_spat_5", name:"Грунт для спатифиллума 5л (WB)", platform:"WB", tag:"Спатифиллум", url:"https://www.wildberries.ru/catalog/450413475/detail.aspx?targetUrl=GP" },
      { id:"wb_spat_3", name:"Грунт для спатифиллума 3л (WB)", platform:"WB", tag:"Спатифиллум", url:"https://www.wildberries.ru/catalog/591266116/detail.aspx?targetUrl=EX" },

      { id:"wb_mon_5", name:"Грунт для монстеры 5л (WB)", platform:"WB", tag:"Монстера", url:"https://www.wildberries.ru/catalog/434106528/detail.aspx?targetUrl=GP" },
      { id:"wb_ficus_5", name:"Грунт для фикуса и пальм 5л (WB)", platform:"WB", tag:"Фикус/Пальмы", url:"https://www.wildberries.ru/catalog/447870726/detail.aspx?targetUrl=GP" },
      { id:"wb_aroid_5", name:"Грунт для ароидных 5л (WB)", platform:"WB", tag:"Ароидные", url:"https://www.wildberries.ru/catalog/432265446/detail.aspx?targetUrl=GP" },

      { id:"wb_drain_5", name:"Дренаж керамзитовый 5л (WB)", platform:"WB", tag:"Дренаж", url:"https://www.wildberries.ru/catalog/278148308/detail.aspx" },
      { id:"wb_bark_2", name:"Кора для орхидей 2л (WB)", platform:"WB", tag:"Кора", url:"https://www.wildberries.ru/catalog/365230106/detail.aspx" },
      { id:"wb_bark_5", name:"Кора для орхидей 5л (WB)", platform:"WB", tag:"Кора", url:"https://www.wildberries.ru/catalog/365245989/detail.aspx" },
      { id:"wb_mulch_5", name:"Кора для мульчирования 5л (WB)", platform:"WB", tag:"Мульча", url:"https://www.wildberries.ru/catalog/265569113/detail.aspx" },

      // OZON
      { id:"oz_orch_2", name:"Грунт для орхидей 2л (Ozon)", platform:"Ozon", tag:"Орхидеи", url:"https://www.ozon.ru/product/grunt-dlya-orhidey-1581895369/?at=QktJjA0g7cLnQ6m3IQ0lO3QtLwx3V1UVGrEYkHWY9knO" },
      { id:"oz_orch_3", name:"Грунт для орхидей 3л (Ozon)", platform:"Ozon", tag:"Орхидеи", url:"https://www.ozon.ru/product/grunt-dlya-orhidey-3l-1655185529/?at=QktJjA0g7cLnQ6m3IQ0lO3QtLwx3V1UVGrEYkHWY9knO&from_sku=1581895369&oos_search=false" },
      { id:"oz_orch_5", name:"Грунт для орхидей 5л (Ozon)", platform:"Ozon", tag:"Орхидеи", url:"https://www.ozon.ru/product/grunt-dlya-orhidey-substrat-5l-1971223869/?at=QktJjA0g7cLnQ6m3IQ0lO3QtLwx3V1UVGrEYkHWY9knO&from_sku=1581895369&oos_search=false" },
      { id:"oz_zami_5", name:"Грунт для замиокулькаса 5л (Ozon)", platform:"Ozon", tag:"Замиокулькас", url:"https://www.ozon.ru/product/grunt-dlya-zamiokulkasa-5l-2209951547/?_bctx=CAQQhoB8&hs=1" },
      { id:"oz_spat_5", name:"Грунт для спатифиллума 5л (Ozon)", platform:"Ozon", tag:"Спатифиллум", url:"https://www.ozon.ru/product/grunt-dlya-spatifilluma-5l-2361594678/?from_sku=2209951547&oos_search=false" },
      { id:"oz_aroid_5", name:"Грунт для ароидных 5л (Ozon)", platform:"Ozon", tag:"Ароидные", url:"https://www.ozon.ru/product/grunt-dlya-zamiokulkasa-spatifilluma-anturiuma-monstery-2361164827/?from_sku=2209951547&oos_search=false" },
      { id:"oz_dek_5", name:"Грунт для декабриста 5л (Ozon)", platform:"Ozon", tag:"Декабрист", url:"https://www.ozon.ru/product/grunt-dlya-dekabrista-5l-3260866085/?from_sku=2209951547&oos_search=false" },
      { id:"oz_citrus_5", name:"Грунт для цитрусовых 5л (Ozon)", platform:"Ozon", tag:"Цитрусы", url:"https://www.ozon.ru/product/grunt-dlya-tsitrusovyh-rasteniy-limona-mandarina-avokado-i-mango-5l-3261099633/?from_sku=2209951547&oos_search=false" },
    ];

    const plants = [
      {
        id:"spathiphyllum",
        title:"Спатифиллум",
        subtitle:"«Женское счастье»",
        topics:{
          wild:"В природе спатифиллум растёт в тёплых влажных лесах, часто в полутени. Почва богатая органикой, но корни должны дышать — без застоя воды.",
          watering:"Любит равномерную влажность. Полив после подсыхания верхних 2–3 см. Важно: не превращать горшок в болото.",
          care:"Яркий рассеянный свет. Прямое солнце может обжигать листья. В глубокой тени цветение ухудшается. Дренаж обязателен; при сухом воздухе полезно повышать влажность.",
          repotting:"Молодые — раз в 1–2 года. Взрослые — раз в 2–3 года или перевалка. Лучшее время: весна. После пересадки 7–10 дней полив умеренный.",
          mistakes:"Перелив + тяжёлый грунт, холодные сквозняки, пересушка на солнце."
        },
        products:[
          { name:"Грунт 5л (WB)", url:"https://www.wildberries.ru/catalog/450413475/detail.aspx?targetUrl=GP" },
          { name:"Грунт 3л (WB)", url:"https://www.wildberries.ru/catalog/591266116/detail.aspx?targetUrl=EX" },
          { name:"Грунт 5л (Ozon)", url:"https://www.ozon.ru/product/grunt-dlya-spatifilluma-5l-2361594678/?from_sku=2209951547&oos_search=false" },
        ]
      },
      {
        id:"zamioculcas",
        title:"Замиокулькас",
        subtitle:"«Долларовое дерево»",
        topics:{
          wild:"Родина — засушливые районы Восточной Африки. Запасает воду в клубнях и листьях. Главный принцип — воздух у корней и отсутствие перелива.",
          watering:"Лучше недолить, чем перелить. Полив только после хорошего просыхания грунта. Зимой — минимально.",
          care:"От яркого рассеянного света до полутени. Дренаж обязателен, субстрат рыхлый.",
          repotting:"Раз в 2–3 года или когда горшок тесен. Перевалка предпочтительнее. После пересадки 5–7 дней без полива.",
          mistakes:"Частый полив, тяжёлый грунт, отсутствие дренажа → риск гнили клубней."
        },
        products:[
          { name:"Грунт 5л (WB)", url:"https://www.wildberries.ru/catalog/327492373/detail.aspx?targetUrl=GP" },
          { name:"Грунт 3л (WB)", url:"https://www.wildberries.ru/catalog/321383073/detail.aspx?targetUrl=GP" },
          { name:"Грунт 5л (Ozon)", url:"https://www.ozon.ru/product/grunt-dlya-zamiokulkasa-5l-2209951547/?_bctx=CAQQhoB8&hs=1" },
        ]
      },
      {
        id:"phalaenopsis",
        title:"Орхидея (Фаленопсис)",
        subtitle:"Эпифит, растёт на коре",
        topics:{
          wild:"Фаленопсис — эпифит: в природе растёт на деревьях. Корни получают воздух и влагу из среды. Нужна структура (кора), а не «земля».",
          watering:"После подсыхания коры. Часто удобнее замачивание 10–15 минут и полное стекание воды. Вода в кашпо/розетке — нельзя.",
          care:"Яркий рассеянный свет, проветривание. Прозрачный горшок помогает контролировать корни.",
          repotting:"Каждые 1.5–2 года или при разложении коры/проблемах. Гнилые корни удалять стерильно. Кору не утрамбовывать.",
          mistakes:"Посадка в торфяные грунты, постоянная влажность без просушки, вода в розетке."
        },
        products:[
          { name:"Грунт 2л (WB)", url:"https://www.wildberries.ru/catalog/230055721/detail.aspx?targetUrl=GP" },
          { name:"Грунт 5л (WB)", url:"https://www.wildberries.ru/catalog/340068487/detail.aspx?targetUrl=GP" },
          { name:"Кора 2л (WB)", url:"https://www.wildberries.ru/catalog/365230106/detail.aspx" },
          { name:"Кора 5л (WB)", url:"https://www.wildberries.ru/catalog/365245989/detail.aspx" },
          { name:"Грунт 2л (Ozon)", url:"https://www.ozon.ru/product/grunt-dlya-orhidey-1581895369/?at=QktJjA0g7cLnQ6m3IQ0lO3QtLwx3V1UVGrEYkHWY9knO" },
        ]
      },
      {
        id:"ficus",
        title:"Фикус",
        subtitle:"Бенджамина / Каучуконосный",
        topics:{
          wild:"Фикусы — тропические/субтропические. В природе вырастают крупными деревьями. Важна стабильность условий без резких перепадов.",
          watering:"Полив после подсыхания верхних 2–4 см. Перелив — главный риск. Зимой полив реже.",
          care:"Яркий рассеянный свет. Избегать сквозняков и резких перестановок. Дренаж обязателен.",
          repotting:"Молодые — раз в год (весна). Взрослые — раз в 2–3 года + замена верхнего слоя грунта.",
          mistakes:"Перелив, тяжёлый грунт, сквозняки и перестановки → листопад."
        },
        products:[
          { name:"Грунт для фикуса и пальм 5л (WB)", url:"https://www.wildberries.ru/catalog/447870726/detail.aspx?targetUrl=GP" },
        ]
      },
      {
        id:"palms",
        title:"Пальмы",
        subtitle:"Хамедорея / Арека и др.",
        topics:{
          wild:"Пальмы — жители тёплых регионов. У корней важны воздух и отсутствие застоя воды.",
          watering:"После подсыхания верхних 2–3 см. Дренаж критически важен. Не допускать «болота».",
          care:"Яркий рассеянный свет. При сухом воздухе сохнут кончики — полезно повышать влажность.",
          repotting:"Не любят стресс. Молодые — раз в 1–2 года, взрослые — раз в 2–4 года, лучше перевалка.",
          mistakes:"Тяжёлый грунт без дренажа, перелив, сухой воздух, холодный сквозняк."
        },
        products:[
          { name:"Грунт для фикуса и пальм 5л (WB)", url:"https://www.wildberries.ru/catalog/447870726/detail.aspx?targetUrl=GP" },
        ]
      }
    ];

    // Views
    const subtitle = document.getElementById("pageSubtitle");
    const viewHome = document.getElementById("viewHome");
    const viewShop = document.getElementById("viewShop");
    const viewGuide = document.getElementById("viewGuide");
    const viewPlant = document.getElementById("viewPlant");
    const viewCatalog = document.getElementById("viewCatalog");
    const viewAbout = document.getElementById("viewAbout");

    function showOnly(view){
      [viewHome,viewShop,viewGuide,viewPlant,viewCatalog,viewAbout].forEach(v => v.style.display="none");
      view.style.display="block";
      window.scrollTo({top:0,behavior:"smooth"});
    }

    // Home navigation
    document.getElementById("goShop").addEventListener("click", ()=>{subtitle.textContent="Магазин"; showOnly(viewShop); haptic("impact");});
    document.getElementById("goGuide").addEventListener("click", ()=>{subtitle.textContent="Справочник"; showOnly(viewGuide); haptic("impact"); renderPlants();});
    document.getElementById("goCatalog").addEventListener("click", ()=>{subtitle.textContent="Каталог"; showOnly(viewCatalog); haptic("impact"); renderCatalog();});
    document.getElementById("goAbout").addEventListener("click", ()=>{subtitle.textContent="О нас"; showOnly(viewAbout); haptic("impact");});

    // Top buttons
    document.getElementById("btnHome").addEventListener("click", ()=>{subtitle.textContent="Мини-приложение: магазин + справочник"; showOnly(viewHome);});
    function openSupport(){ openLink("https://t.me/melnikovnikitaa"); }
    document.getElementById("btnSupport").addEventListener("click", openSupport);

    // Back buttons
    document.getElementById("backFromShop").addEventListener("click", ()=>{subtitle.textContent="Мини-приложение: магазин + справочник"; showOnly(viewHome);});
    document.getElementById("backFromGuide").addEventListener("click", ()=>{subtitle.textContent="Мини-приложение: магазин + справочник"; showOnly(viewHome);});
    document.getElementById("backFromCatalog").addEventListener("click", ()=>{subtitle.textContent="Мини-приложение: магазин + справочник"; showOnly(viewHome);});
    document.getElementById("backFromAbout").addEventListener("click", ()=>{subtitle.textContent="Мини-приложение: магазин + справочник"; showOnly(viewHome);});

    // Shop buttons
    document.getElementById("openWBShop").addEventListener("click", ()=>openLink(shops.wb));
    document.getElementById("openOZShop").addEventListener("click", ()=>openLink(shops.oz));
    document.getElementById("qOrch").addEventListener("click", ()=>openLink("https://www.wildberries.ru/catalog/230055721/detail.aspx?targetUrl=GP"));
    document.getElementById("qZami").addEventListener("click", ()=>openLink("https://www.wildberries.ru/catalog/327492373/detail.aspx?targetUrl=GP"));
    document.getElementById("qSpat").addEventListener("click", ()=>openLink("https://www.wildberries.ru/catalog/450413475/detail.aspx?targetUrl=GP"));

    // Guide: list plants
    const plantsList = document.getElementById("plantsList");
    const plantSearch = document.getElementById("plantSearch");
    document.getElementById("clearPlantSearch").addEventListener("click", ()=>{plantSearch.value=""; renderPlants();});
    plantSearch.addEventListener("input", renderPlants);

    function renderPlants(){
      const q = (plantSearch.value||"").trim().toLowerCase();
      const filtered = plants.filter(p => (p.title+" "+p.subtitle).toLowerCase().includes(q));
      plantsList.innerHTML = "";
      if (filtered.length===0){
        plantsList.innerHTML = `<div class="hint">Ничего не найдено.</div>`;
        return;
      }
      filtered.forEach(p=>{
        const el=document.createElement("div");
        el.className="item";
        el.innerHTML=`
          <div class="meta">
            <div class="ttl">${escapeHtml(p.title)}</div>
            <div class="sub">${escapeHtml(p.subtitle)}</div>
          </div>
          <div class="actions">
            <button class="btn primary" data-openplant="${escapeAttr(p.id)}">Открыть</button>
          </div>
        `;
        plantsList.appendChild(el);
      });
      plantsList.querySelectorAll("[data-openplant]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const id = btn.getAttribute("data-openplant");
          openPlant(id);
        });
      });
    }

    // Guide: plant detail (topics)
    const plantTitle = document.getElementById("plantTitle");
    const plantSubtitle = document.getElementById("plantSubtitle");
    const topicTabs = document.getElementById("topicTabs");
    const topicContent = document.getElementById("topicContent");
    const plantProducts = document.getElementById("plantProducts");
    document.getElementById("backToPlants").addEventListener("click", ()=>{
      subtitle.textContent="Справочник";
      showOnly(viewGuide);
    });

    const TOPICS = [
      {key:"repotting", label:"Пересадка"},
      {key:"watering", label:"Полив"},
      {key:"care", label:"Уход"},
      {key:"wild", label:"В природе"},
      {key:"mistakes", label:"Ошибки"},
    ];

    let currentPlant = null;
    let currentTopic = "repotting";

    function openPlant(plantId){
      currentPlant = plants.find(p=>p.id===plantId);
      if (!currentPlant) return;
      subtitle.textContent="Справочник";
      showOnly(viewPlant);

      plantTitle.textContent = currentPlant.title;
      plantSubtitle.textContent = "Выбери интересующий раздел";

      // Tabs
      topicTabs.innerHTML = "";
      TOPICS.forEach(t=>{
        const b=document.createElement("div");
        b.className="pillTab" + (t.key===currentTopic ? " active" : "");
        b.textContent=t.label;
        b.addEventListener("click", ()=>{
          currentTopic = t.key;
          renderTopic();
        });
        topicTabs.appendChild(b);
      });

      // Products
      plantProducts.innerHTML = "";
      (currentPlant.products||[]).forEach(pr=>{
        const b=document.createElement("button");
        b.className="btn";
        b.textContent=pr.name;
        b.addEventListener("click", ()=>openLink(pr.url));
        plantProducts.appendChild(b);
      });

      renderTopic();
    }

    function renderTopic(){
      // set active tab
      [...topicTabs.children].forEach((el,i)=>{
        const key = TOPICS[i].key;
        el.classList.toggle("active", key===currentTopic);
      });

      const titleMap = {
        repotting:"Правила пересадки",
        watering:"Правила полива",
        care:"Правила ухода",
        wild:"Как растёт в природе",
        mistakes:"Частые ошибки"
      };

      const text = currentPlant?.topics?.[currentTopic] || "Нет данных.";
      topicContent.innerHTML = `
        <div class="sectionBox">
          <b>${escapeHtml(titleMap[currentTopic] || "Раздел")}</b>
          <div>${escapeHtml(text)}</div>
        </div>
      `;
      haptic("impact","light");
    }

    // Catalog
    const catalogList = document.getElementById("catalogList");
    const catalogSearch = document.getElementById("catalogSearch");
    document.getElementById("clearCatalogSearch").addEventListener("click", ()=>{catalogSearch.value=""; renderCatalog();});
    catalogSearch.addEventListener("input", renderCatalog);

    function renderCatalog(){
      const q=(catalogSearch.value||"").trim().toLowerCase();
      const filtered = products.filter(p => (p.name+" "+p.platform+" "+(p.tag||"")).toLowerCase().includes(q));
      catalogList.innerHTML="";
      if(filtered.length===0){
        catalogList.innerHTML=`<div class="hint">Ничего не найдено.</div>`;
        return;
      }
      filtered.forEach(p=>{
        const el=document.createElement("div");
        el.className="item";
        el.innerHTML=`
          <div class="meta">
            <div class="ttl">${escapeHtml(p.name)}</div>
            <div class="sub">
              <span class="badge">${escapeHtml(p.platform)}</span>
              <span class="badge">${escapeHtml(p.tag||"")}</span>
            </div>
          </div>
          <div class="actions">
            <button class="btn" data-open="${escapeAttr(p.url)}">Открыть</button>
          </div>
        `;
        catalogList.appendChild(el);
      });
      catalogList.querySelectorAll("[data-open]").forEach(btn=>{
        btn.addEventListener("click", ()=>openLink(btn.getAttribute("data-open")));
      });
    }

    // Utils
    function escapeHtml(s){
      return String(s)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }
    function escapeAttr(s){ return escapeHtml(s); }

    // Boot
    initTelegram();
    showOnly(viewHome);
  </script>
</body>
</html>

